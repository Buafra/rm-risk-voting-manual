<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Tier 1 Risk Voting & 6×6 Matrix Translation Manual</title>
  <meta name="description" content="Forced ranking voting (Method B) + emerging risk inclusion + RM translation to a 6×6 impact/likelihood matrix." />
  <style>
    :root{
      --bg:#0b1020;
      --card:#111a33;
      --card2:#0f1630;
      --text:#e7ecff;
      --muted:#b8c0ff;
      --line:#26325f;
      --accent:#6ea8ff;
      --ok:#4ade80;
      --warn:#fbbf24;
      --bad:#fb7185;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius: 16px;
      --radius2: 12px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      background: radial-gradient(1200px 700px at 15% 10%, rgba(110,168,255,.18), transparent 60%),
                  radial-gradient(900px 600px at 90% 20%, rgba(251,191,36,.10), transparent 55%),
                  var(--bg);
      color:var(--text);
      font-family: var(--sans);
      line-height:1.5;
    }
    a{color:var(--accent); text-decoration:none}
    a:hover{text-decoration:underline}
    header{
      padding: 28px 18px 8px;
      max-width:1100px;
      margin:0 auto;
    }
    .title{
      display:flex; gap:14px; align-items:flex-start; flex-wrap:wrap;
    }
    .badge{
      padding:6px 10px;
      border:1px solid rgba(110,168,255,.35);
      background: rgba(110,168,255,.12);
      color: var(--text);
      border-radius: 999px;
      font-size: 12px;
      letter-spacing:.2px;
      white-space:nowrap;
    }
    h1{margin:0; font-size: 28px}
    .subtitle{margin:10px 0 0; color: var(--muted); max-width: 78ch}

    main{max-width:1100px; margin:0 auto; padding: 14px 18px 60px;}
    .grid{
      display:grid;
      grid-template-columns: 1.15fr .85fr;
      gap: 14px;
    }
    @media (max-width: 980px){
      .grid{grid-template-columns: 1fr}
    }
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01));
      border: 1px solid rgba(255,255,255,.07);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 16px;
    }
    .card h2{margin:0 0 8px; font-size: 18px}
    .card h3{margin:16px 0 8px; font-size: 15px; color: var(--text)}
    .small{font-size: 13px; color: var(--muted)}
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding: 8px 10px;
      background: rgba(255,255,255,.04);
      border:1px solid rgba(255,255,255,.08);
      border-radius: 999px;
      font-size: 13px;
      color: var(--text);
    }
    .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
    .kpi{
      display:flex; flex-direction:column; gap:2px;
      padding: 12px;
      border-radius: var(--radius2);
      background: rgba(0,0,0,.18);
      border: 1px solid rgba(255,255,255,.07);
      min-width: 180px;
    }
    .kpi .label{font-size: 12px; color: var(--muted)}
    .kpi .value{font-family: var(--mono); font-size: 18px}
    .good{color: var(--ok)}
    .warn{color: var(--warn)}
    .bad{color: var(--bad)}
    .hr{height:1px; background: rgba(255,255,255,.08); margin: 14px 0}

    table{
      width:100%;
      border-collapse:separate;
      border-spacing:0;
      overflow:hidden;
      border-radius: var(--radius2);
      border:1px solid rgba(255,255,255,.09);
      background: rgba(0,0,0,.12);
    }
    th,td{
      padding: 10px 10px;
      border-bottom: 1px solid rgba(255,255,255,.08);
      vertical-align:top;
      font-size: 13px;
    }
    th{
      text-align:left;
      color: var(--text);
      background: rgba(255,255,255,.05);
      font-weight: 650;
    }
    tr:last-child td{border-bottom:0}
    .right{text-align:right}
    .muted{color:var(--muted)}
    .mono{font-family: var(--mono)}
    .hint{font-size: 12px; color: var(--muted); margin-top: 6px}

    .form{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    @media (max-width: 520px){
      .form{grid-template-columns: 1fr}
    }
    label{
      display:flex;
      flex-direction:column;
      gap:6px;
      font-size: 12px;
      color: var(--muted);
    }
    input, select, textarea{
      width:100%;
      padding: 10px 10px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      color: var(--text);
      outline:none;
    }
    input:focus, select:focus, textarea:focus{
      border-color: rgba(110,168,255,.55);
      box-shadow: 0 0 0 3px rgba(110,168,255,.15);
    }
    textarea{min-height: 70px; resize: vertical}
    button{
      cursor:pointer;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(110,168,255,.18);
      color: var(--text);
      font-weight: 650;
    }
    button:hover{background: rgba(110,168,255,.24)}
    .btnrow{display:flex; gap:10px; flex-wrap:wrap; align-items:center}

    .note{
      padding: 12px;
      border-radius: var(--radius2);
      background: rgba(251,191,36,.10);
      border: 1px solid rgba(251,191,36,.28);
      color: var(--text);
      font-size: 13px;
    }

    .matrix{
      display:grid;
      grid-template-columns: 44px repeat(6, 1fr);
      gap: 6px;
      align-items:stretch;
      margin-top: 10px;
    }
    .mcell, .mhead{
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,.08);
      background: rgba(0,0,0,.14);
      padding: 8px;
      min-height: 54px;
      font-size: 12px;
    }
    .mhead{
      min-height:unset;
      text-align:center;
      color: var(--muted);
      background: rgba(255,255,255,.04);
    }
    .yhead{
      display:flex; align-items:center; justify-content:center;
      font-family: var(--mono);
      color: var(--muted);
      background: rgba(255,255,255,.04);
    }
    .dot{
      display:block;
      padding: 6px 8px;
      border-radius: 10px;
      border: 1px solid rgba(110,168,255,.35);
      background: rgba(110,168,255,.12);
      margin: 6px 0 0;
    }
    .legend{
      display:flex; gap:10px; flex-wrap:wrap; margin-top: 10px;
      font-size: 12px; color: var(--muted);
    }
    footer{
      max-width:1100px;
      margin: 0 auto;
      padding: 0 18px 26px;
      color: var(--muted);
      font-size: 12px;
    }
    code.inline{
      font-family: var(--mono);
      font-size: 12px;
      padding: 2px 6px;
      border-radius: 8px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.18);
      color: var(--text);
    }
  </style>
</head>

<body>
<header>
  <div class="title">
    <span class="badge">RM Internal Manual</span>
    <span class="badge">Forced Ranking (Method B)</span>
    <span class="badge">6×6 Risk Matrix Translation</span>
  </div>
  <h1>Tier 1 Risk Voting & Translation Manual</h1>
  <p class="subtitle">
    Management prioritizes Tier 1 risk themes through voting (without impact/likelihood scoring).
    Risk Management then translates the consolidated results into a <strong>6×6 Impact × Likelihood</strong> matrix using aggregated exposure, trends, and control effectiveness.
  </p>
</header>

<main>
  <div class="grid">
    <!-- Left: Manual -->
    <section class="card">
      <h2>Process Summary</h2>
      <div class="row">
        <span class="pill">Voters: <strong id="pillVoters">13</strong></span>
        <span class="pill">Base Tier 1 risks: <strong>3</strong></span>
        <span class="pill">Emerging risk: <strong>conditional</strong></span>
        <span class="pill">Matrix: <strong>6×6</strong></span>
      </div>

      <div class="hr"></div>

      <h3>Step 1 — Emerging Risk Inclusion (Yes/No)</h3>
      <p class="small">
        All <strong><span id="votersText1">13</span></strong> management members vote <strong>Yes</strong> or <strong>No</strong> on whether the emerging risk is promoted to Tier 1 for this cycle.
      </p>
      <table>
        <thead>
          <tr>
            <th>Rule</th>
            <th>Decision</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Simple majority</td>
            <td><span class="mono" id="majorityRule">≥ 7 Yes votes out of 13</span> ⇒ Emerging risk included in ranking</td>
          </tr>
          <tr>
            <td>If not approved</td>
            <td>Emerging risk is monitored as “emerging” only (not ranked as Tier 1)</td>
          </tr>
        </tbody>
      </table>

      <div class="hr"></div>

      <h3>Step 2 — Forced Ranking of Tier 1 Risks</h3>
      <p class="small">
        If the emerging risk is approved, total risks to rank become <strong>4</strong>. Otherwise, <strong>3</strong>.
        Each of the <strong><span id="votersText2">13</span></strong> voters ranks all Tier 1 risks (no ties).
      </p>

      <div class="note">
        <strong>Key principle:</strong> Management provides <em>priority</em> (what worries them most). RM provides <em>translation</em> (how it fits the risk framework).
      </div>

      <div class="hr"></div>

      <h3>Step 3 — Total Points (How it’s calculated)</h3>
      <p class="small">
        Total Points for a risk = sum of points assigned by all voters based on rank.
        This captures both <strong>intensity</strong> (high ranks) and <strong>consensus</strong> (many voters).
      </p>

      <table>
        <thead>
          <tr>
            <th>Rank</th>
            <th class="right">Points</th>
            <th>Meaning</th>
          </tr>
        </thead>
        <tbody id="rankPointsTable">
          <!-- Filled by JS (3-risk or 4-risk scheme) -->
        </tbody>
      </table>
      <p class="hint">
        Validation rule: total system points are fixed and must equal
        <code class="inline">voters × (sum of rank points)</code>.
      </p>

      <div class="hr"></div>

      <h3>Step 4 — RM Translation to 6×6 Matrix</h3>
      <p class="small">
        RM translates management priorities into the 6×6 matrix by assigning:
        <strong>Impact (1–6)</strong> based on enterprise consequence, and
        <strong>Likelihood (1–6)</strong> based on aggregated underlying risks, incidents, trends, and control effectiveness.
      </p>

      <table>
        <thead>
          <tr>
            <th>Component</th>
            <th>Who sets it</th>
            <th>Basis</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>Management Priority</strong></td>
            <td>Management voters</td>
            <td>Forced ranking results (Total Points)</td>
          </tr>
          <tr>
            <td><strong>Impact (1–6)</strong></td>
            <td>RM team</td>
            <td>Enterprise consequence; generally stable year-on-year</td>
          </tr>
          <tr>
            <td><strong>Likelihood (1–6)</strong></td>
            <td>RM team</td>
            <td>Aggregated exposure: incidents, trends, controls, environment</td>
          </tr>
        </tbody>
      </table>

      <div class="hr"></div>

      <h3>Governance Statement (Use Verbatim)</h3>
      <textarea readonly id="governanceText"></textarea>

      <div class="hr"></div>

      <h3>DOs & DON’Ts</h3>
      <table>
        <thead><tr><th>DO</th><th>DON’T</th></tr></thead>
        <tbody>
          <tr>
            <td>Record voter count and inclusion vote outcome</td>
            <td>Ask management to score likelihood/impact during the voting session</td>
          </tr>
          <tr>
            <td>Validate total system points (fixed total)</td>
            <td>Average underlying risk scores mechanically without judgment</td>
          </tr>
          <tr>
            <td>Keep Impact stable unless strategy changes</td>
            <td>Override management priorities; revisit translation assumptions instead</td>
          </tr>
        </tbody>
      </table>
    </section>

    <!-- Right: Interactive calculator + matrix preview -->
    <aside class="card">
      <h2>Voting Calculator & Validator</h2>
      <p class="small">Use this panel to calculate total points, validate totals, and preview matrix placement notes.</p>

      <div class="form" style="margin-top:10px">
        <label>
          Number of voters
          <input id="voters" type="number" min="1" value="13" />
        </label>

        <label>
          Emerging risk included?
          <select id="emergingIncluded">
            <option value="yes" selected>Yes (rank 4 risks)</option>
            <option value="no">No (rank 3 risks)</option>
          </select>
        </label>

        <label>
          Emerging risk YES votes (Step 1)
          <input id="yesVotes" type="number" min="0" value="9" />
        </label>

        <label>
          Majority threshold (auto)
          <input id="majority" type="text" readonly />
        </label>
      </div>

      <div class="hr"></div>

      <div class="row">
        <div class="kpi">
          <div class="label"># Risks ranked</div>
          <div class="value" id="kpiRisks">4</div>
        </div>
        <div class="kpi">
          <div class="label">Points per voter</div>
          <div class="value" id="kpiPointsPerVoter">10</div>
        </div>
        <div class="kpi">
          <div class="label">Total system points</div>
          <div class="value" id="kpiSystemPoints">130</div>
        </div>
      </div>

      <div class="hr"></div>

      <h3>Step 2: Enter rank distribution (counts)</h3>
      <p class="small">For each risk, enter how many of the <span id="votersText3">13</span> voters placed it at each rank. Each risk must sum to voters.</p>

      <table id="distTable">
        <thead>
          <tr>
            <th>Risk</th>
            <th class="right">Rank 1</th>
            <th class="right">Rank 2</th>
            <th class="right">Rank 3</th>
            <th class="right" id="rank4Head">Rank 4</th>
            <th class="right">Total Points</th>
            <th class="right">Check</th>
          </tr>
        </thead>
        <tbody id="distBody">
          <!-- Filled by JS -->
        </tbody>
        <tfoot>
          <tr>
            <th colspan="5" class="right">Sum of all risks' points</th>
            <th class="right mono" id="sumPoints">—</th>
            <th class="right mono" id="sumCheck">—</th>
          </tr>
        </tfoot>
      </table>

      <div class="btnrow" style="margin-top:12px">
        <button id="recalc">Recalculate</button>
        <button id="reset">Reset Example</button>
      </div>

      <div class="hr"></div>

      <h3>6×6 Matrix Preview (Conceptual)</h3>
      <p class="small">
        The matrix placement is done by RM using Impact & Likelihood. This preview shows a blank 6×6 grid where you can
        type a risk label in the appropriate cell once assessed.
      </p>

      <div class="matrix" id="matrix">
        <!-- Filled by JS -->
      </div>
      <div class="legend">
        <span>Y-axis: Impact (6 high → 1 low)</span>
        <span>•</span>
        <span>X-axis: Likelihood (1 low → 6 high)</span>
      </div>

      <div class="hr"></div>

      <h3>Translation Alignment Rule (Internal Control)</h3>
      <p class="small">
        If management ranks a risk very high but it lands low on the matrix, RM should revisit the translation assumptions
        (usually likelihood), not the management voting.
      </p>
    </aside>
  </div>
</main>

<footer>
  <div class="mono">Tip:</div>
  <div>
    Host internally as a static page (SharePoint, internal web server) or open locally in a browser.
    Replace risk names with your organization’s Tier 1 risk themes.
  </div>
</footer>

<script>
  // ---------- Helpers ----------
  function majorityThreshold(n){
    // simple majority: floor(n/2)+1
    return Math.floor(n/2) + 1;
  }

  function getRankScheme(risksCount){
    // Returns points per rank array (index 0 => rank1)
    // For 4 risks: [4,3,2,1]; For 3 risks: [3,2,1]
    if(risksCount === 4) return [4,3,2,1];
    return [3,2,1];
  }

  function fmt(n){ return (Number.isFinite(n) ? n.toString() : "—"); }

  // ---------- State ----------
  const defaultRisks = [
    { id:"r1", name:"Cyber & Information Security" },
    { id:"r2", name:"Financial Sustainability" },
    { id:"r3", name:"Regulatory & Compliance" },
    { id:"er", name:"Emerging Risk" }
  ];

  // Example distributions (for 4 risks, 13 voters)
  // Each risk row sums to 13
  const example4 = {
    r1: [8,3,2,0],   // 8 rank1, 3 rank2, 2 rank3, 0 rank4 => 45
    r2: [4,6,2,1],   // 38
    r3: [0,1,3,9],   // 25
    er: [1,3,6,3]    // 30
  };

  // Example distributions (for 3 risks, 13 voters)
  const example3 = {
    r1: [7,4,2],     // 7*3 + 4*2 + 2*1 = 31
    r2: [4,6,3],     // 27
    r3: [2,3,8]      // 20
  };

  // ---------- DOM refs ----------
  const elVoters = document.getElementById("voters");
  const elEmergingIncluded = document.getElementById("emergingIncluded");
  const elYesVotes = document.getElementById("yesVotes");
  const elMajority = document.getElementById("majority");

  const pillVoters = document.getElementById("pillVoters");
  const votersText1 = document.getElementById("votersText1");
  const votersText2 = document.getElementById("votersText2");
  const votersText3 = document.getElementById("votersText3");
  const majorityRule = document.getElementById("majorityRule");

  const kpiRisks = document.getElementById("kpiRisks");
  const kpiPointsPerVoter = document.getElementById("kpiPointsPerVoter");
  const kpiSystemPoints = document.getElementById("kpiSystemPoints");

  const rankPointsTable = document.getElementById("rankPointsTable");
  const distBody = document.getElementById("distBody");
  const rank4Head = document.getElementById("rank4Head");

  const sumPoints = document.getElementById("sumPoints");
  const sumCheck = document.getElementById("sumCheck");

  const governanceText = document.getElementById("governanceText");

  const btnRecalc = document.getElementById("recalc");
  const btnReset = document.getElementById("reset");

  // ---------- Renderers ----------
  function renderGovernance(voters){
    governanceText.value =
`“${voters} members of senior management voted on the inclusion of an emerging risk and subsequently ranked Tier 1 risk themes using a forced-ranking approach.
The Risk Management team translated the consolidated results of the ${voters} voters into a 6×6 impact and likelihood matrix based on aggregated underlying risks, trends, and control effectiveness.”`;
  }

  function renderRankPoints(points){
    rankPointsTable.innerHTML = "";
    points.forEach((p, i) => {
      const rank = i+1;
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td><strong>Rank ${rank}</strong></td>
        <td class="right mono">${p}</td>
        <td class="muted">${rank === 1 ? "Highest concern" : (rank === points.length ? "Lowest concern" : "Relative concern")}</td>
      `;
      rankPointsTable.appendChild(tr);
    });
  }

  function riskRows(risksCount){
    // if emerging included => 4 risks; else => 3 risks (exclude emerging)
    return (risksCount === 4) ? defaultRisks : defaultRisks.slice(0,3);
  }

  function renderDistributionTable(voters, risksCount){
    const points = getRankScheme(risksCount);
    renderRankPoints(points);

    // toggle Rank 4 column header visibility
    if(risksCount === 4){
      rank4Head.style.display = "";
    }else{
      rank4Head.style.display = "none";
    }

    distBody.innerHTML = "";
    const rows = riskRows(risksCount);

    rows.forEach((r) => {
      const tr = document.createElement("tr");
      tr.setAttribute("data-risk", r.id);

      const inputs = points.map((_, i) => {
        const show = (i === 3 && risksCount !== 4) ? 'style="display:none"' : "";
        return `<td class="right" ${show}>
          <input class="rankIn" data-rank="${i}" type="number" min="0" value="0" style="text-align:right" />
        </td>`;
      }).join("");

      tr.innerHTML = `
        <td><strong>${r.name}</strong></td>
        ${inputs}
        <td class="right mono totalPts">—</td>
        <td class="right mono rowCheck">—</td>
      `;

      distBody.appendChild(tr);
    });
  }

  function loadExample(voters, risksCount){
    const data = (risksCount === 4) ? example4 : example3;
    const rows = distBody.querySelectorAll("tr");
    rows.forEach(tr => {
      const rid = tr.getAttribute("data-risk");
      const arr = data[rid] || [];
      tr.querySelectorAll("input.rankIn").forEach((inp, idx) => {
        inp.value = fmt(arr[idx] ?? 0);
      });
    });
  }

  function recalcAll(){
    const voters = Math.max(1, parseInt(elVoters.value || "13", 10));
    const included = (elEmergingIncluded.value === "yes");
    const risksCount = included ? 4 : 3;

    // majority threshold
    const maj = majorityThreshold(voters);
    elMajority.value = `≥ ${maj} YES`;
    majorityRule.textContent = `≥ ${maj} Yes votes out of ${voters}`;

    // update text
    pillVoters.textContent = voters;
    votersText1.textContent = voters;
    votersText2.textContent = voters;
    votersText3.textContent = voters;
    renderGovernance(voters);

    // inclusion vote guard: if emerging not included, ignore yesVotes display logic
    const yes = Math.max(0, parseInt(elYesVotes.value || "0", 10));
    if(included){
      // if yes votes don't meet majority, show warning style by changing border
      elYesVotes.style.borderColor = (yes >= maj) ? "rgba(74,222,128,.45)" : "rgba(251,191,36,.45)";
    } else {
      elYesVotes.style.borderColor = "rgba(255,255,255,.12)";
    }

    // rank points
    const rankPoints = getRankScheme(risksCount);
    const pointsPerVoter = rankPoints.reduce((a,b)=>a+b,0);
    const systemPoints = voters * pointsPerVoter;

    kpiRisks.textContent = risksCount;
    kpiPointsPerVoter.textContent = pointsPerVoter;
    kpiSystemPoints.textContent = systemPoints;

    // Re-render distribution table to match 3 vs 4 risks
    renderDistributionTable(voters, risksCount);

    // Keep example values on refresh if possible
    loadExample(voters, risksCount);

    // Now compute totals from inputs
    computeTotals(voters, risksCount);
  }

  function computeTotals(voters, risksCount){
    const rankPoints = getRankScheme(risksCount);
    const pointsPerVoter = rankPoints.reduce((a,b)=>a+b,0);
    const systemPoints = voters * pointsPerVoter;

    let totalAllRisks = 0;
    const rows = distBody.querySelectorAll("tr");

    rows.forEach(tr => {
      const inputs = Array.from(tr.querySelectorAll("input.rankIn"));
      const counts = inputs.map(inp => Math.max(0, parseInt(inp.value || "0", 10)));

      const sumCounts = counts.reduce((a,b)=>a+b,0);
      const pts = counts.reduce((acc, c, i) => acc + c * rankPoints[i], 0);

      tr.querySelector(".totalPts").textContent = pts.toString();
      totalAllRisks += pts;

      // Row check: must equal voters
      const checkEl = tr.querySelector(".rowCheck");
      if(sumCounts === voters){
        checkEl.textContent = "OK";
        checkEl.classList.remove("bad","warn");
        checkEl.classList.add("good");
      } else {
        checkEl.textContent = `${sumCounts}/${voters}`;
        checkEl.classList.remove("good","bad");
        checkEl.classList.add("warn");
      }
    });

    sumPoints.textContent = totalAllRisks.toString();

    // System check
    if(totalAllRisks === systemPoints){
      sumCheck.textContent = "OK";
      sumCheck.classList.remove("bad","warn");
      sumCheck.classList.add("good");
    } else {
      sumCheck.textContent = `${totalAllRisks}/${systemPoints}`;
      sumCheck.classList.remove("good","bad");
      sumCheck.classList.add("warn");
    }
  }

  // ---------- Matrix ----------
  function renderMatrix(){
    const matrix = document.getElementById("matrix");
    matrix.innerHTML = "";

    // top-left blank corner
    matrix.appendChild(cell("mhead", ""));

    // likelihood headers 1..6
    for(let x=1; x<=6; x++){
      matrix.appendChild(cell("mhead", "L " + x));
    }

    // rows for impact 6..1
    for(let y=6; y>=1; y--){
      matrix.appendChild(cell("mhead yhead", "I " + y));
      for(let x=1; x<=6; x++){
        const c = document.createElement("div");
        c.className = "mcell";
        c.innerHTML = `
          <div class="muted mono">(${y},${x})</div>
          <input aria-label="cell ${y} ${x}" placeholder="Add risk label…" style="
              margin-top:6px;width:100%;padding:8px 8px;border-radius:10px;border:1px solid rgba(255,255,255,.10);
              background:rgba(0,0,0,.14);color:var(--text);outline:none" />
        `;
        matrix.appendChild(c);
      }
    }
  }

  function cell(cls, text){
    const d = document.createElement("div");
    d.className = cls;
    d.textContent = text;
    return d;
  }

  // ---------- Events ----------
  btnRecalc.addEventListener("click", () => {
    const voters = Math.max(1, parseInt(elVoters.value || "13", 10));
    const included = (elEmergingIncluded.value === "yes");
    const risksCount = included ? 4 : 3;
    computeTotals(voters, risksCount);
  });

  btnReset.addEventListener("click", () => {
    // reset to defaults
    elVoters.value = 13;
    elEmergingIncluded.value = "yes";
    elYesVotes.value = 9;
    recalcAll();
  });

  elVoters.addEventListener("input", () => recalcAll());
  elEmergingIncluded.addEventListener("change", () => recalcAll());
  elYesVotes.addEventListener("input", () => {
    // only recompute visuals; table doesn't depend on yesVotes
    const voters = Math.max(1, parseInt(elVoters.value || "13", 10));
    const maj = majorityThreshold(voters);
    const yes = Math.max(0, parseInt(elYesVotes.value || "0", 10));
    if(elEmergingIncluded.value === "yes"){
      elYesVotes.style.borderColor = (yes >= maj) ? "rgba(74,222,128,.45)" : "rgba(251,191,36,.45)";
    } else {
      elYesVotes.style.borderColor = "rgba(255,255,255,.12)";
    }
  });

  // Delegate input changes in table
  distBody.addEventListener("input", (e) => {
    if(!e.target.classList.contains("rankIn")) return;
    const voters = Math.max(1, parseInt(elVoters.value || "13", 10));
    const included = (elEmergingIncluded.value === "yes");
    const risksCount = included ? 4 : 3;
    computeTotals(voters, risksCount);
  });

  // ---------- Init ----------
  renderMatrix();
  recalcAll();
</script>
</body>
</html>
